{% extends "admin/base.html" %}

{% block content %}

<div class = "ui container">

    {% if datasets | length == 0 %}

        <div class="ui info icon message">
            <i class="exclamation icon"></i>
            <div class="content">
            <div class="header">
                No datasets
            </div>
            <p>Add datasets</p>
            </div>
        </div>

    {% endif %}

    <!-- Dataset uploading form -->

    <h4 class="ui horizontal divider header">
        Dataset Information
    </h4>
    <form action="{{ url_for('admin.upload') }}" class="ui form" enctype="multipart/form-data" method = "POST">
        
        <div class="field">
          <label>Name</label>
            <div class="field">
                <input type="text" name="dataset_name" placeholder="Dataset Name" required>
            </div>
        </div>

        <div class="field">
            <div class="field">
                <input type="file" name="zipfile" required>
            </div>
        </div>

        <button type="submit" class="ui button primary">Upload Dataset</button>
    </form>
    
    <!-- Availabe datasets -->
    {% if datasets | length > 0 %}

        <h4 class="ui horizontal divider header">
            Available Dataset
        </h4>
        <table class="ui compact celled table">
            <thead>
                <tr>
                <th class="seven wide">Dataset</th>
                <th class="two wide">Source</th>
                <th class="two wide">Deidentified</th>
                <th class="two wide">File count</th>
                <th class="three wide">Upload Status</th>
                </tr>
            </thead>
            <tbody>
                <!-- Render the dataset -->
                <!-- id, name, description , file_count, total: sql fields -->
                {% for data in datasets %}
                    <tr>

                        {%if data['upload_status'] == 1 %}
                            <td>{{ data['name'] }}</td>
                            <td><a href="{{ url_for('admin.dataset_with_id', asset_type='src', dset_id=data['id']) }}">Download</a></td>
                            <td><a href="{{ url_for('admin.dataset_with_id', asset_type='dfd', dset_id=data['id']) }}">Download</a></td>
                            <td>{{ data['filecount'] }}</td>
                            <td class="positive"><i class="checkmark icon"></i> Uploaded</td>
                        {% else %}
                            <td>{{ data['name'] }}</td>
                            <td class="warning"><i class="sync icon"></i> Processing...</td>
                            <td class="warning"><i class="sync icon"></i> Processing...</td>
                            <td>0</td>
                            <td class="warning"><i class="sync icon"></i> Processing...</td>
                        {% endif %}

                    </tr>
                {% endfor %}

            </tbody>
            <tfoot class="full-width">
                <tr>
                <th colspan="16">
                    <!-- Render pagination for other datasets -->
                    <div class="ui right floated pagination menu">
                        {% if page > 0 %}
                            <!-- Calculate the prev page and use as a link -->
                            {% set link = page-1 %}
                            <a href="{{ url_for('admin.all_datasets', page=link) }}" class="active item">Prev</a>
                        {% endif %}

                        <!-- Page*limit must be less than total no. of datasets -->
                        {% if page*20 < total %}
                            <!-- Calculate the next page and use as a link -->
                            {% set link = page+1 %}
                            <a href="{{ url_for('admin.all_datasets', page=link) }}" class="item">Next</a>
                        {% endif %}
                    </div>
                </th>
                </tr>
            </tfoot>
        </table>
    {% endif %}

</div>
{% endblock %}