{% extends "client/base.html" %}

{% block content %}

<div class = "ui container">
    
    {% if datasets | length == 0 %}

        <div class="ui info icon message">
            <i class="exclamation icon"></i>
            <div class="content">
            <div class="header">
                No datasets
            </div>
            <p>Add datasets</p>
            </div>
        </div>

    {% endif %}
    
    <!-- Availabe datasets -->
    {% if datasets | length > 0 %}

        <h4 class="ui horizontal divider header">
            Available Dataset
        </h4>
        <table class="ui compact celled table">
            <thead>
                <tr>
                <th class="ten wide">Dataset</th>
                <th class="two wide">File Count</th>
                <th class="two wide">Status</th>
                <th class="two wide">Download</th>
                </tr>
            </thead>
            <tbody>
                <!-- Render the dataset -->
                <!-- id, name, file_count, total: sql fields -->
                {% for dataset in datasets %}

                        <td>{{ dataset['name'] }}</td>
                        <td>{{ dataset['filecount'] }}</td>

                        <!-- Conditionally render approved, processing, rejected and request td element -->
                        <!-- Try to get dataset status from dset_status
                             If present means an application was submitted -->
                        {% set status = dset_status.get(dataset['id'], None) %}

                        {% if status == 'processing' %}
                            <td class="warning"><i class="sync icon"></i> Processing...</td>
                        {% elif status == 'approved' %}
                            <td class="positive"><i class="checkmark icon"></i> Approved</td>
                        {% else %}
                            <td class="blue"><a href="{{ url_for('client.application_for_dataset', dset_id=dataset['id']) }}"><span class="ui blue text">Request Access</span></a></td>
                        {% endif %}

                        {% if dataset['id'] in dset_status.keys() %}
                            <td><a href="{{ url_for('client.dataset_with_id', dset_id=dataset['id']) }}">Download</a></td>
                        {% else %}
                            <td>Not Available</td>
                        {% endif %}

                    </tr>
                {% endfor %}

            </tbody>
            <tfoot class="full-width">
                <tr>
                <th colspan="4">
                    <!-- Render pagination for other datasets -->
                    <div class="ui right floated pagination menu">
                        {% if page > 0 %}
                            <!-- Calculate the prev page and use as a link -->
                            {% set link = page-1 %}
                            <a href="{{ url_for('client.all_datasets', page=link) }}" class="active item">Prev</a>
                        {% endif %}

                        <!-- Page*limit must be less than total no. of datasets -->
                        {% if page*20 < total %}
                            <!-- Calculate the next page and use as a link -->
                            {% set link = page+1 %}
                            <a href="{{ url_for('client.all_datasets', page=link) }}" class="item">Next</a>
                        {% endif %}
                    </div>
                </th>
                </tr>
            </tfoot>
        </table>
    {% endif %}

</div>
{% endblock %}